<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" href="/css/index.css">
		<link rel="stylesheet" href="/css/games.css">
		<link rel="icon" type="image/png" href="/img/cornicon.png">
		<title>Corn URL editor</title>
	</head>
	<body>
		<div id="mainDiv">
			<div style="margin: auto;">
				<div class="sidebar" id="urlList">
				</div>
			</div>
			<div class="sidebar">
				<input id="gameId" placeholder="Put a unique ID here">
				<input id="gameUrl" placeholder="Put a game URL here">
				<input id="gameTitle" placeholder="Put a game name here">
				<input id="gameInfo" placeholder="Put some info about the game here, if you want">
				<button class="button" onclick="addCustom()" title="Needs ID, URL, and name">Add your game</button>
				<a class="button" href="index.html">Back</a>
			</div>
		</div>
		<footer>Licensed under the <a href="license.txt">MIT License</a>. Image under the <a href="https://creativecommons.org/licenses/by/4.0/legalcode">CC BY 4.0</a>.</footer>
		<script src="/scripts/gameinfo.js"></script>
		<script>
			function readCustomGames() {
				let ret = [];
				for (let i = 0; window.localStorage.getItem("game:" + i) != null; i++) {
					ret.push(window.localStorage.getItem("game:" + i));
				}
				return ret;
			}
			function readCustomData(gameList, data) {
				let ret = [];
				for (game of gameList) {
					ret.push(window.localStorage.getItem(game + ":" + data));
				}
				return ret;
			}
			let customGameList = [];
			let customUrlList = [];
			let customTitleList = [];
			let customInfoList = [];
			function showGames() {
				let urlList = document.getElementById("urlList");
				while (urlList.firstChild) {urlList.removeChild(urlList.firstChild);}
				for (i = 0; i < customGameList.length; i++) {
					button = document.createElement("button");
					button.className = "button";
					button.innerHTML = customGameList[i];
					button.addEventListener("click", switchGames.bind(null, i));
					urlList.appendChild(button);
				}
			}
			function readAllData() {
				customGameList = readCustomGames();
				customUrlList = readCustomData(customGameList, "url");
				customTitleList = readCustomData(customGameList, "title");
				customInfoList = readCustomData(customGameList, "info");
				showGames();
			}
			readAllData();
			function writeAllData() {
				let storage = window.localStorage;
				for (let i = 0; storage.getItem("game:" + i) != null; i++) {
					let game = storage.getItem("game:" + i);
					storage.removeItem("game:" + i);
					storage.removeItem(i + ":url");
					storage.removeItem(i + ":title");
					storage.removeItem(i + ":info");
				}
				for (let i = 0; i < gameList.length; i++) {
					storage.setItem("game:" + i, customGameList[i]);
					storage.setItem(customGameList[i] + ":url", customUrlList[i]);
					storage.setItem(customGameList[i] + ":title", customTitleList[i]);
					storage.setItem(customGameList[i] + ":info", customInfoList[i]);
				}
			}
			function addCustom() {
				customGameList.push(document.getElementById("gameId").value);
				customUrlList.push(document.getElementById("gameUrl").value);
				customTitleList.push(document.getElementById("gameTitle").value);
				customInfoList.push(document.getElementById("gameInfo").value);
				writeAllData();
			}
			function removeCustom(index) {
				customGameList.splice(index, 1);
				customUrlList.splice(index, 1);
				customTitleList.splice(index, 1);
				customInfoList.splice(index, 1);
				writeAllData();
			}
		</script>
		<script src="/scripts/themeloader.js"></script>
	</body>
</html>
